<!DOCTYPE html><html class="h-100"><head><title>pageTitle: not defined</title><link rel="stylesheet" href="/stylesheets/style.css"><link rel="stylesheet" href="/bootstrap/bootstrap.min.css"><script src="/bootstrap/bootstrap.bundle.min.js"> </script><script>function getDate() {
  var date = new Date().toLocaleString();
  let arr = date.split(",");
  date = arr[0] + "<br>" + arr[1];

  document.getElementById("timedisplay").innerHTML = date.toLocaleString();
}
setInterval(getDate, 0);
</script><script>var pageProps={};</script></head><body class="h-100"><div class="container-fluid h-100 d-flex flex-column"> <div class="row"><div class="col-3"><img src="/img/logo_bortek.png" alt="Бортек" id="logo"></div><div class="col my-auto mx-auto "><div class="h2 " id="pageTitle">pageTitle: not defined</div></div><div class="col-1 my-auto mx-auto "><div class="h5" id="timedisplay"></div></div><hr></div><div class="row h-100"><div class="col"><div class="h-100" id="pageBody"><p>--------------------- debugging info -----------------------------</p><pre>{&quot;id&quot;:&quot;TasksManager&quot;,&quot;ln&quot;:&quot;ClassTasksManager(TasksManager)::&quot;,&quot;header&quot;:{&quot;ua&quot;:&quot;Створення програми&quot;,&quot;en&quot;:&quot;Program creating&quot;,&quot;ru&quot;:&quot;Создание программы&quot;},&quot;type&quot;:&quot;select&quot;,&quot;value&quot;:0,&quot;comment&quot;:{&quot;ua&quot;:&quot;Після редадгування програми натисніть кнопку [Застосувати]&quot;,&quot;en&quot;:&quot;After program creation, push [Accept] button&quot;,&quot;ru&quot;:&quot;После редактирования програмы, нажмите кнопку [Применить] &quot;},&quot;regs&quot;:{},&quot;reg&quot;:{&quot;id&quot;:&quot;taskType&quot;,&quot;ln&quot;:&quot;ClassReg_select(taskType)::&quot;,&quot;header&quot;:{&quot;ua&quot;:&quot;Оберіть тип кроку&quot;,&quot;en&quot;:&quot;Select type of step&quot;,&quot;ru&quot;:&quot;Выберите тип шага&quot;},&quot;type&quot;:&quot;select&quot;,&quot;value&quot;:0,&quot;comment&quot;:{&quot;ua&quot;:&quot;Доступні задачі&quot;,&quot;en&quot;:&quot;Avaliable tasks&quot;,&quot;ru&quot;:&quot;Доступные задачи &quot;},&quot;regs&quot;:{&quot;empty&quot;:{&quot;id&quot;:&quot;empty&quot;,&quot;ln&quot;:&quot;Class_Task_general()::&quot;,&quot;header&quot;:{&quot;ua&quot;:&quot;Виберіть тип кроку&quot;,&quot;en&quot;:&quot;Select type of step&quot;,&quot;ru&quot;:&quot;Выберите тип шага&quot;},&quot;type&quot;:&quot;task&quot;,&quot;value&quot;:null,&quot;comment&quot;:{&quot;ua&quot;:&quot;Тип кроку не вказано&quot;,&quot;en&quot;:&quot;Type of the Step not defined&quot;,&quot;ru&quot;:&quot;Тип шага не указан&quot;},&quot;regs&quot;:{}},&quot;ClassTaskThermo&quot;:{&quot;id&quot;:&quot;ClassTaskThermo&quot;,&quot;ln&quot;:&quot;Class_Task_general()::&quot;,&quot;header&quot;:{&quot;ua&quot;:&quot;Термообробка&quot;,&quot;en&quot;:&quot;Heattreatment&quot;,&quot;ru&quot;:&quot;Термообработка&quot;},&quot;type&quot;:&quot;task&quot;,&quot;value&quot;:0,&quot;comment&quot;:{&quot;ua&quot;:&quot;Термообробка&quot;,&quot;en&quot;:&quot;Thermal&quot;,&quot;ru&quot;:&quot;Термообработка&quot;},&quot;regs&quot;:{&quot;tT&quot;:{&quot;id&quot;:&quot;tT&quot;,&quot;ln&quot;:&quot;ClassReg_select(tT)::&quot;,&quot;header&quot;:{&quot;ua&quot;:&quot;T,°C&quot;,&quot;en&quot;:&quot;T,°C&quot;,&quot;ru&quot;:&quot;T,°C&quot;},&quot;type&quot;:&quot;number&quot;,&quot;value&quot;:0,&quot;comment&quot;:{&quot;ua&quot;:&quot;Цільова температура&quot;,&quot;en&quot;:&quot;Task temperature&quot;,&quot;ru&quot;:&quot;Целевая температура&quot;},&quot;min&quot;:0,&quot;max&quot;:150},&quot;errTmin&quot;:{&quot;id&quot;:&quot;errTmin&quot;,&quot;ln&quot;:&quot;ClassReg_select(errTmin)::&quot;,&quot;header&quot;:{&quot;ua&quot;:&quot;min dT,°C&quot;,&quot;en&quot;:&quot;min dT,°C&quot;,&quot;ru&quot;:&quot;min dT,°C&quot;},&quot;type&quot;:&quot;number&quot;,&quot;value&quot;:-25,&quot;comment&quot;:{&quot;ua&quot;:&quot;Максим. відх. темп. вниз (0=вимкнути)&quot;,&quot;en&quot;:&quot;Limit of low temperature (0=disable)&quot;,&quot;ru&quot;:&quot;Максим. отклонение темп. вниз (0=выключено)&quot;},&quot;min&quot;:-100,&quot;max&quot;:0},&quot;errTmax&quot;:{&quot;id&quot;:&quot;errTmax&quot;,&quot;ln&quot;:&quot;ClassReg_select(errTmax)::&quot;,&quot;header&quot;:{&quot;ua&quot;:&quot;max dT,°C&quot;,&quot;en&quot;:&quot;max dT,°C&quot;,&quot;ru&quot;:&quot;max dT,°C&quot;},&quot;type&quot;:&quot;number&quot;,&quot;value&quot;:25,&quot;comment&quot;:{&quot;ua&quot;:&quot;Максим. перевищення температури (0=вимкнути)&quot;,&quot;en&quot;:&quot;Limit of high temperature (0=disable)&quot;,&quot;ru&quot;:&quot;Максим. превышение температуры (0=выключено)&quot;},&quot;min&quot;:0,&quot;max&quot;:100},&quot;regMode&quot;:{&quot;id&quot;:&quot;regMode&quot;,&quot;ln&quot;:&quot;ClassReg_select(regMode)::&quot;,&quot;header&quot;:{&quot;ua&quot;:&quot;Регулювання&quot;,&quot;en&quot;:&quot;Regulation&quot;,&quot;ru&quot;:&quot;Регулирование&quot;},&quot;type&quot;:&quot;select&quot;,&quot;value&quot;:null,&quot;comment&quot;:{&quot;ua&quot;:&quot;Закон регулювання&quot;,&quot;en&quot;:&quot;Control type&quot;,&quot;ru&quot;:&quot;Закон регулирования&quot;},&quot;regs&quot;:{&quot;pos&quot;:{&quot;id&quot;:&quot;pos&quot;,&quot;ln&quot;:&quot;ClassReg_select(pos)::&quot;,&quot;header&quot;:{&quot;ua&quot;:&quot;Позиційний&quot;,&quot;en&quot;:&quot;Positional&quot;,&quot;ru&quot;:&quot;Позиционный&quot;},&quot;type&quot;:&quot;select&quot;,&quot;value&quot;:0,&quot;comment&quot;:{&quot;ua&quot;:&quot;Позиційний закон регулювання&quot;,&quot;en&quot;:&quot;Positional regulation&quot;,&quot;ru&quot;:&quot;Позиционный закон регуллирования&quot;},&quot;regs&quot;:{&quot;o&quot;:{&quot;id&quot;:&quot;o&quot;,&quot;ln&quot;:&quot;ClassReg_select(o)::&quot;,&quot;header&quot;:{&quot;ua&quot;:&quot;Неузгодження&quot;,&quot;en&quot;:&quot;Difference&quot;,&quot;ru&quot;:&quot;Рассогласование&quot;},&quot;type&quot;:&quot;number&quot;,&quot;value&quot;:-2,&quot;comment&quot;:{&quot;ua&quot;:&quot;Неузгодження температур,°С&quot;,&quot;en&quot;:&quot;Temperature difference,°С&quot;,&quot;ru&quot;:&quot;Рассогласование температур,°С&quot;},&quot;min&quot;:-20,&quot;max&quot;:0}}},&quot;pid&quot;:{&quot;id&quot;:&quot;pid&quot;,&quot;ln&quot;:&quot;ClassReg_select(pid)::&quot;,&quot;header&quot;:{&quot;ua&quot;:&quot;ПІД&quot;,&quot;en&quot;:&quot;PID&quot;,&quot;ru&quot;:&quot;ПИД&quot;},&quot;type&quot;:&quot;select&quot;,&quot;value&quot;:0,&quot;comment&quot;:{&quot;ua&quot;:&quot;ПІД закон регулювання&quot;,&quot;en&quot;:&quot;PID regulation&quot;,&quot;ru&quot;:&quot;ПИД закон регуллирования&quot;},&quot;regs&quot;:{&quot;o&quot;:{&quot;id&quot;:&quot;o&quot;,&quot;ln&quot;:&quot;ClassReg_select(o)::&quot;,&quot;header&quot;:{&quot;ua&quot;:&quot;П&quot;,&quot;en&quot;:&quot;P&quot;,&quot;ru&quot;:&quot;П&quot;},&quot;type&quot;:&quot;number&quot;,&quot;value&quot;:5,&quot;comment&quot;:{&quot;ua&quot;:&quot;Пропорційна складова&quot;,&quot;en&quot;:&quot;Proportional gain&quot;,&quot;ru&quot;:&quot;Пропорциональная составляющая&quot;},&quot;min&quot;:0,&quot;max&quot;:100},&quot;i&quot;:{&quot;id&quot;:&quot;ti&quot;,&quot;ln&quot;:&quot;ClassReg_select(ti)::&quot;,&quot;header&quot;:{&quot;ua&quot;:&quot;І&quot;,&quot;en&quot;:&quot;I&quot;,&quot;ru&quot;:&quot;И&quot;},&quot;type&quot;:&quot;number&quot;,&quot;value&quot;:5,&quot;comment&quot;:{&quot;ua&quot;:&quot;Інтегральна складова&quot;,&quot;en&quot;:&quot;Integral gain&quot;,&quot;ru&quot;:&quot;Интегральная составляющая&quot;},&quot;min&quot;:0,&quot;max&quot;:100},&quot;d&quot;:{&quot;id&quot;:&quot;td&quot;,&quot;ln&quot;:&quot;ClassReg_select(td)::&quot;,&quot;header&quot;:{&quot;ua&quot;:&quot;Д&quot;,&quot;en&quot;:&quot;D&quot;,&quot;ru&quot;:&quot;Д&quot;},&quot;type&quot;:&quot;number&quot;,&quot;value&quot;:5,&quot;comment&quot;:{&quot;ua&quot;:&quot;Диференційна складова&quot;,&quot;en&quot;:&quot;Differencial gain&quot;,&quot;ru&quot;:&quot;Диферинциальная составляющая&quot;},&quot;min&quot;:0,&quot;max&quot;:100}}}}}}}}},&quot;list&quot;:[]}  </pre><p>--------------------- debugging info -----------------------------</p><div class="row"><div class="col"><h3>Завдання</h3></div></div><div class="row"><div class="col" id="tasksContainer"></div></div><script>const lang= 'ua'; 
const tasks={};
tasks.reg = JSON.parse(  '{"id":"taskType","ln":"ClassReg_select(taskType)::","header":{"ua":"Оберіть тип кроку","en":"Select type of step","ru":"Выберите тип шага"},"type":"select","value":0,"comment":{"ua":"Доступні задачі","en":"Avaliable tasks","ru":"Доступные задачи "},"regs":{"empty":{"id":"empty","ln":"Class_Task_general()::","header":{"ua":"Виберіть тип кроку","en":"Select type of step","ru":"Выберите тип шага"},"type":"task","value":null,"comment":{"ua":"Тип кроку не вказано","en":"Type of the Step not defined","ru":"Тип шага не указан"},"regs":{}},"ClassTaskThermo":{"id":"ClassTaskThermo","ln":"Class_Task_general()::","header":{"ua":"Термообробка","en":"Heattreatment","ru":"Термообработка"},"type":"task","value":0,"comment":{"ua":"Термообробка","en":"Thermal","ru":"Термообработка"},"regs":{"tT":{"id":"tT","ln":"ClassReg_select(tT)::","header":{"ua":"T,°C","en":"T,°C","ru":"T,°C"},"type":"number","value":0,"comment":{"ua":"Цільова температура","en":"Task temperature","ru":"Целевая температура"},"min":0,"max":150},"errTmin":{"id":"errTmin","ln":"ClassReg_select(errTmin)::","header":{"ua":"min dT,°C","en":"min dT,°C","ru":"min dT,°C"},"type":"number","value":-25,"comment":{"ua":"Максим. відх. темп. вниз (0=вимкнути)","en":"Limit of low temperature (0=disable)","ru":"Максим. отклонение темп. вниз (0=выключено)"},"min":-100,"max":0},"errTmax":{"id":"errTmax","ln":"ClassReg_select(errTmax)::","header":{"ua":"max dT,°C","en":"max dT,°C","ru":"max dT,°C"},"type":"number","value":25,"comment":{"ua":"Максим. перевищення температури (0=вимкнути)","en":"Limit of high temperature (0=disable)","ru":"Максим. превышение температуры (0=выключено)"},"min":0,"max":100},"regMode":{"id":"regMode","ln":"ClassReg_select(regMode)::","header":{"ua":"Регулювання","en":"Regulation","ru":"Регулирование"},"type":"select","value":null,"comment":{"ua":"Закон регулювання","en":"Control type","ru":"Закон регулирования"},"regs":{"pos":{"id":"pos","ln":"ClassReg_select(pos)::","header":{"ua":"Позиційний","en":"Positional","ru":"Позиционный"},"type":"select","value":0,"comment":{"ua":"Позиційний закон регулювання","en":"Positional regulation","ru":"Позиционный закон регуллирования"},"regs":{"o":{"id":"o","ln":"ClassReg_select(o)::","header":{"ua":"Неузгодження","en":"Difference","ru":"Рассогласование"},"type":"number","value":-2,"comment":{"ua":"Неузгодження температур,°С","en":"Temperature difference,°С","ru":"Рассогласование температур,°С"},"min":-20,"max":0}}},"pid":{"id":"pid","ln":"ClassReg_select(pid)::","header":{"ua":"ПІД","en":"PID","ru":"ПИД"},"type":"select","value":0,"comment":{"ua":"ПІД закон регулювання","en":"PID regulation","ru":"ПИД закон регуллирования"},"regs":{"o":{"id":"o","ln":"ClassReg_select(o)::","header":{"ua":"П","en":"P","ru":"П"},"type":"number","value":5,"comment":{"ua":"Пропорційна складова","en":"Proportional gain","ru":"Пропорциональная составляющая"},"min":0,"max":100},"i":{"id":"ti","ln":"ClassReg_select(ti)::","header":{"ua":"І","en":"I","ru":"И"},"type":"number","value":5,"comment":{"ua":"Інтегральна складова","en":"Integral gain","ru":"Интегральная составляющая"},"min":0,"max":100},"d":{"id":"td","ln":"ClassReg_select(td)::","header":{"ua":"Д","en":"D","ru":"Д"},"type":"number","value":5,"comment":{"ua":"Диференційна складова","en":"Differencial gain","ru":"Диферинциальная составляющая"},"min":0,"max":100}}}}}}}}}' );
tasks.type = "select"
tasks.program = JSON.parse(  '[]' );
tasks.container = document.getElementById( 'tasksContainer' );</script><script> // створюємо прапорці трасування, так як в нас багато файлів нам потрыбно в кожному
// з них вмикати трасування окремо від інших , тому кожний файл з кодом
// перед виконанням свого коду запамятовує поточне значення trace в beforeTrace: 'beforeTrace=trace'
// після завершення відновлює попереднє значення 'trace=beforeTrace', таким чином модулі не будуть заважати іншим
let trace = 1,
  beforeTrace = 0;

/**
 * Створює відображення рядка кроку програми
 * @param {Array} list
 *
 */

tasks.createRow = (container, prefix) => {
  let row = document.createElement("div");
  row.classList.add("row");
  row.classList.add("border");
  row.classList.add("border-secondary");
  row.id = prefix;
  let stepNumber = document.createElement("div");
  stepNumber.classList.add("col-1");
  stepNumber.innerHTML = "<h6>" + prefix + "</h6>";
  row.appendChild(stepNumber);
  return row;
};

tasks.renderList = function (list = []) {
  let trace = 1,
    ln = "tasks.renderList()::";
  let header = document.createElement("div");
  header.classList.add("row");
  let title = document.createElement("div");
  title.classList.add("col");
  title.innerHTML = `<h6>${tasks.reg.header[lang]}</h6>`;
  header.appendChild(title);
  // header = document.createElement("h4");
  //header.innerHTML = tasks.reg.header[lang];
  tasks.container.classList = "border";
  this.container.appendChild(header);

  let step = this.createRow(tasks.container, "st1");
  if (trace) {
    console.log(ln + `step=`);
    console.dir(step);
  }
  if (list.length == 0) {
    // список програм пустий
    let el = new ClassElementSelect({
      prefix: "st1",
      reg: tasks.reg,
      container: step,
    });
    if (trace) {
      console.log(ln + `el=`);
      console.dir(el);
    }
    step.appendChild(el.div);
    //return;
  }

  tasks.container.appendChild(step);
  // for (let key in list) {
  //   trace ? console.log(ln + "key=" + key) : null;
  //   if (regsList.hasOwnProperty(key)) {
  //     if (trace) {
  //       console.dir(list[key]);
  //     }
  //   }
  // }
};

/** список доступних типів регістрів, містить в собі класи, що створюють відповідні елементи
 * {select:ClassElementSelect, number:ClassElementNumber, ...}
 */
tasks.elementsTypes = {};

class ClassCreateElement {
  /**
   * Створює налаштований DOM-елемент загального типу
   * @param {Object} props
   * @property {string} props.prefix - префікс ля id елементу
   * @property {string} props.tag - тип елементу (number,range,  select)
   * @property {Object} props.reg  - типовий регістр
   * @property {Object} props.container - контейнер в якому потрібно розмістити елемент
   */
  constructor(props = {}) {
    this.ln = "ClassCreateElement()::";
    let trace = 1,
      ln = this.ln + "constructror()::";
    trace ? console.log(ln + "props=") : null;
    trace ? console.dir(props) : null;
    // -- батьківський контейнер для елементу -----
    if (!props.container) {
      console.error(ln + "Не вказано батьківський контейнер!!!");
    } else {
      this.container = props.container;
    }
    // -- тег основного елемента, щоб створити шаблон
    this.tag = props.tag;
    // -- префікс -----
    this.prefix = props.prefix;
    // -- регістр
    this.reg = props.reg;

    // -- id - елементу
    this.id = props.prefix + "__" + props.reg.id; //два підкреслення (щоб легко відділяти id регістру)
    // контейнер для всього елементу
    this.div = document.createElement("div");
    this.div.classList.add("col");
    this.div.classList.add("form-group");
    // ---- <label> --------
    this.label = document.createElement("label");
    this.label.setAttribute("for", this.id);
    this.label.classList.add("h6");
    this.label.innerHTML = this.reg.header[lang];
    // ---- <title> --------
    this.comment = document.createElement("small");
    this.comment.innerHTML = this.reg.comment[lang];
    // ---- Field --------
    this.field = document.createElement(this.tag);
    this.field.dataset.beforeValue = "";
    this.field.classList.add("form-control");
    this.field.classList.add(this.prefix);
    this.field.id = this.id;
    this.div.appendChild(this.label);
    this.div.appendChild(this.field);
    this.div.appendChild(this.comment);
    // -- поточне значення -----
    if (props.reg.value | (props.reg.value === 0)) {
      this.value = props.reg.value;
      this.setValue(this.value);
    }
  }

  onchange(event) {
    let ln = this.ln + "onchange()::";
    if (trace) {
      console.log(ln + "this=");
      console.dir(this);
    }
    trace ? console.log(ln + "this.field.value=" + this.getValue()) : null;
  }

  setValue(val) {
    this.field.dataset.beforeValue = this.value;
    this.value = val;
    this.field.value = val;
  }

  getValue() {
    return this.field.value;
  }
}

tasks.ClassCreateElement = ClassCreateElement;
// -----------  element: select -------------------
beforeTrace = trace;
trace = 1;
/**
 * Створює та повертає елемент вибору
 *
 */
class ClassElementSelect extends ClassCreateElement {
  constructor(props = {}) {
    props.tag = "select";
    super(props);
    this.ln = "ClassElementSelect(" + props.reg.id + ")::";
    let trace = 1,
      ln = "ClassElementSelect()::";
    this.regs = this.reg.regs;

    // створюємо список <option>
    let keys = "";
    for (let key in this.regs) {
      if (this.regs.hasOwnProperty(key)) {
        let trace = 1;
        // if (keys == "") {
        //   // якщо це перша опція, вибираємо її як початкову
        //   this.setValue(field.value = key;
        //   this.field.dataset.beforeValue = key;
        // }
        trace ? console.log(ln + "key=" + key) : null;
        keys += `<option value='${key}'> ${this.reg.regs[key].header[lang]} </option>`;
      }
    } //for
    // -- опції вибору -------
    this.field.innerHTML = keys;
    // -- обробник зміни значення поля ----------
    this.field.onchange = this.onchange.bind(this);

    if (trace) {
      console.log(ln + "this=");
      console.dir(this);
    }
  }
  onchange(event) {
    let trace = 1,
      ln = this.ln + "onchange()::";
    super.onchange(event);
    let reg = this.regs[this.getValue()];
    this.parseRegs(reg);
  }
  parseRegs(reg) {
    let trace = 1,
      ln = this.ln + `parseRegs(${reg.id})::`;
    trace ? console.log(ln + `Started`) : null;

    for (let key in reg.regs) {
      if (reg.regs.hasOwnProperty(key)) {
        let trace = 1;
        trace ? console.log(ln + "for (key=" + key + ")::") : null;
        let item = reg.regs[key];
        if (tasks.elementsTypes[item.type]) {
          let el = new tasks.elementsTypes[item.type]({
            prefix: this.prefix,
            reg: item,
            container: this.container,
          });
          this.container.appendChild(el.div);
        }
      }
    } //for
  }
}

tasks.elementsTypes["select"] = ClassElementSelect;

trace = beforeTrace;
// -----------  element: select -------------------
beforeTrace = trace;
trace = 1;
/**
 * Створює та повертає елемент вибору
 *
 */
class ClassElementNumber extends ClassCreateElement {
  constructor(props = {}) {
    props.tag = "input";
    super(props);
    this.ln = "ClassElementNumber(" + props.reg.id + ")::";
    let trace = 1,
      ln = this.ln + "Constructor()::";

    // -- опції вибору -------
    //this.field.innerHTML = keys;
    // -- обробник зміни значення поля ----------
    this.field.onchange = this.onchange.bind(this);
    this.field.setAttribute("type", "number");

    if (props.reg.min | (props.reg.min === 0)) {
      this.field.setAttribute("min", props.reg.min);
    }
    if (props.reg.max | (props.reg.max === 0)) {
      this.field.setAttribute("max", props.reg.max);
    }

    if (trace) {
      console.log(ln + "this=");
      console.dir(this);
    }
  }
  onchange(event) {
    let trace = 1,
      ln = this.ln + "onchange()::";
    super.onchange(event);
  }
}

tasks.elementsTypes["number"] = ClassElementNumber;

trace = beforeTrace;
</script><script>//- запускаємо відображення списку кроків програми
tasks.renderList();

</script><div class="row"><div class="col"><button class="btn btn-primary" type="button">Застосувати</button></div></div></div></div></div></div><script src="/bootstrap/bootstrap.min.js"></script></body></html>